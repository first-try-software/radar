<%# Shared trend widget partial for Team, Initiative, and Project pages
    Expects: presenter (TrendPresenter) %>
<% presenter = local_assigns[:presenter] %>

<div id="trend-widget" class="metric-widget metric-widget--trend metric-widget--<%= presenter.trend_css_class %>">
  <div class="metric-widget__header">
    <span class="metric-widget__title">6-Week Trend</span>
    <div style="display: flex; align-items: center; gap: 8px;">
      <div class="info-tooltip">
        <span class="info-tooltip__icon">i</span>
        <div class="info-tooltip__tooltip">
          <div class="info-tooltip__methodology">Weekly average health scores over the past 6 weeks.</div>
          <div class="info-tooltip__range">Range: âˆ’1.0 to +1.0 per week</div>
          <div class="info-tooltip__score">Delta: <%= presenter.delta_summary %></div>
        </div>
      </div>
    </div>
  </div>
  <div class="metric-widget__chart">
    <% if presenter.sufficient_data? %>
      <svg viewBox="0 0 200 50" preserveAspectRatio="none" class="trend-svg">
        <defs>
          <linearGradient id="<%= presenter.gradient_id %>" x1="0%" y1="0%" x2="100%" y2="0%">
            <% presenter.gradient_stops.each do |stop| %>
              <stop offset="<%= stop[:offset] %>%" stop-color="<%= stop[:color] %>" />
            <% end %>
          </linearGradient>
        </defs>
        <polyline class="trend-line-v2" stroke="url(#<%= presenter.gradient_id %>)" points="<%= presenter.polyline_points %>" />
        <% presenter.chart_points.each do |point| %>
          <circle cx="<%= point[:x] %>" cy="<%= point[:y] %>" r="4" class="trend-point-v2 trend-point-v2--<%= point[:health] %>" />
        <% end %>
      </svg>
    <% else %>
      <div class="metric-widget__no-data"><%= presenter.no_data_message %></div>
    <% end %>
  </div>
</div>
