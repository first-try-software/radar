<%
  project = local_assigns[:project]
  project_record = local_assigns[:project_record]
  allowed_states = local_assigns[:allowed_states] || SetProjectState::SETTABLE_STATES
  effective_contact = project.respond_to?(:effective_contact) ? project.effective_contact : project.point_of_contact
  effective_contact ||= project.point_of_contact
%>

<!-- Sticky Header -->
<div class="sticky-header" data-sticky-header>
  <div class="sticky-header__container">
    <div class="sticky-header__left">
      <div class="sticky-header__breadcrumb">
        <%= project.respond_to?(:parent) ? project_breadcrumb(project, project_record) : render_breadcrumb([{ name: 'Radar', path: root_path }]) %>
      </div>
      <div class="sticky-header__title-row">
        <img src="/logo-radar-animated-loop-v8.svg" alt="" class="sticky-header__logo">
        <h2 class="sticky-header__title"><%= project.name %></h2>
      </div>
    </div>
    <div class="sticky-header__right">
      <div class="sticky-header__actions">
        <% if project.archived? %>
          <span class="badge badge--archived">ARCHIVED</span>
        <% end %>
        <div class="sticky-header__badge">
          <span class="badge state state--<%= project.current_state.to_s.tr('_', '-') %>" data-state-badge><%= project.current_state.to_s.tr('_', ' ').upcase %></span>
        </div>
        <button type="button" class="sticky-header__edit-btn" data-action="edit-form#open" aria-label="Edit project">✎</button>
      </div>
      <% if effective_contact.present? %>
        <span class="sticky-header__contact">Contact: <%= effective_contact %></span>
      <% else %>
        <span class="sticky-header__contact sticky-header__contact--missing">No contact specified</span>
      <% end %>
    </div>
  </div>
</div>

<!-- Hero Section -->
<div class="project-hero" data-project-hero>
  <div class="project-hero__breadcrumb" data-hero-breadcrumb>
    <%= project.respond_to?(:parent) ? project_breadcrumb(project, project_record) : render_breadcrumb([{ name: 'Radar', path: root_path }]) %>
  </div>
  <div class="project-hero__actions">
    <% if project.archived? %>
      <span class="badge badge--archived" data-archived-badge>ARCHIVED</span>
    <% end %>
    <div class="state-pill-dropdown"
         data-controller="state-dropdown"
         data-state-dropdown-url-value="<%= state_project_path(project_record) %>">
      <button class="state-pill-toggle" type="button" data-action="state-dropdown#toggle">
        <span class="state-pill state-pill--<%= project.current_state.to_s.tr('_', '-') %>" data-state-badge><%= project.current_state.to_s.tr('_', ' ').titleize %></span>
        <span class="state-pill-arrow">▾</span>
      </button>
      <div class="state-pill-menu state-pill-menu--down" data-state-dropdown-target="menu">
        <% if allowed_states.any? %>
          <% allowed_states.each do |state| %>
            <button type="button" class="state-pill-option" data-state="<%= state %>" data-action="state-dropdown#select">
              <span class="state-pill state-pill--<%= state.to_s.tr('_', '-') %>"><%= state.to_s.tr('_', ' ').titleize %></span>
            </button>
          <% end %>
        <% else %>
          <div class="empty">No further transitions</div>
        <% end %>
      </div>
    </div>
    <button type="button" class="project-hero__edit-btn" data-action="edit-form#open" aria-label="Edit project">✎</button>
  </div>
  <h1 class="project-hero__title" data-project-title><%= project.name %></h1>
  <p class="project-hero__tagline" data-project-tagline<%= ' hidden' if project.description.blank? %>><%= project.description %></p>
  <% if effective_contact.present? %>
    <p class="project-hero__contact" data-project-contact>For more information, contact <strong data-project-poc><%= effective_contact %></strong>.</p>
  <% else %>
    <p class="project-hero__contact project-hero__contact--missing" data-project-contact>Psst! Do me a favor! Tell me who to call if this thing breaks!</p>
  <% end %>
</div>
