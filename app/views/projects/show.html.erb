<% content_for(:title) { "#{@project_record.name} - Radar" } %>
<% allowed_states = SetProjectState::SETTABLE_STATES %>
<% project = @project || @project_record %>

<div data-controller="edit-form" data-edit-form-url-value="<%= project_path(@project_record) %>">

<%= render "projects/header",
    project: project,
    project_record: @project_record,
    allowed_states: allowed_states %>

<% if @health_summary %>
  <%= render "projects/metrics",
      project: project,
      health_summary: @health_summary,
      project_health: @project_health,
      trend_data: @trend_data,
      trend_direction: @trend_direction,
      trend_delta: @trend_delta,
      weeks_of_data: @weeks_of_data,
      confidence_score: @confidence_score,
      confidence_level: @confidence_level,
      confidence_factors: @confidence_factors %>
<% end %>

<!-- Toast Container -->
<div class="toast-container" data-toast-container></div>

<%= render "projects/search",
    project: project,
    project_record: @project_record,
    teams: @teams,
    initiatives: @initiatives,
    all_projects: @all_projects %>

<%= render "projects/child_projects",
    project: project,
    project_record: @project_record %>

<%= render "projects/health_updates",
    project: project,
    project_record: @project_record,
    health_updates: @health_updates,
    allowed_states: allowed_states %>

<%= render "projects/edit_modal",
    project_record: @project_record %>

</div><!-- end edit-form controller wrapper -->

<% if defined?(@errors) && @errors.present? %>
  <div class="errors">
    <ul>
      <% @errors.each do |err| %>
        <li><%= err %></li>
      <% end %>
    </ul>
  </div>
<% end %>
