<%
  initiative = local_assigns[:initiative]
  initiative_record = local_assigns[:initiative_record]
  allowed_states = local_assigns[:allowed_states] || SetInitiativeState::SETTABLE_STATES
  cascading_states = local_assigns[:cascading_states] || Initiative::CASCADING_STATES
  related_project_count = local_assigns[:related_project_count] || 0
%>

<!-- Sticky Header -->
<div class="sticky-header" data-sticky-header>
  <div class="sticky-header__container">
    <div class="sticky-header__left">
      <div class="sticky-header__breadcrumb">
        <%= initiative ? initiative_breadcrumb(initiative, initiative_record) : render_breadcrumb([{ name: 'Radar', path: root_path }]) %>
      </div>
      <div class="sticky-header__title-row">
        <img src="/logo-radar-animated-loop-v8.svg" alt="" class="sticky-header__logo">
        <h2 class="sticky-header__title"><%= initiative_record.name %></h2>
      </div>
    </div>
    <div class="sticky-header__right">
      <div class="sticky-header__actions">
        <% if initiative_record.archived %>
          <span class="badge badge--archived">ARCHIVED</span>
        <% end %>
        <div class="sticky-header__badge">
          <span class="badge state state--<%= initiative_record.current_state.to_s.tr('_', '-') %>" data-state-badge><%= initiative_record.current_state.to_s.tr('_', ' ').upcase %></span>
        </div>
        <button type="button" class="sticky-header__edit-btn" data-action="edit-form#open" aria-label="Edit initiative">✎</button>
      </div>
      <% if initiative_record.point_of_contact.present? %>
        <span class="sticky-header__contact">Contact: <%= initiative_record.point_of_contact %></span>
      <% else %>
        <span class="sticky-header__contact sticky-header__contact--missing">No contact specified</span>
      <% end %>
    </div>
  </div>
</div>

<!-- Hero Section -->
<div class="project-hero" data-project-hero>
  <div class="project-hero__breadcrumb" data-hero-breadcrumb>
    <%= initiative ? initiative_breadcrumb(initiative, initiative_record) : render_breadcrumb([{ name: 'Radar', path: root_path }]) %>
  </div>
  <div class="project-hero__actions">
    <% if initiative_record.archived %>
      <span class="badge badge--archived" data-archived-badge>ARCHIVED</span>
    <% end %>
    <div class="state-pill-dropdown"
         data-controller="initiative-state-dropdown"
         data-initiative-state-dropdown-url-value="<%= state_initiative_path(initiative_record) %>"
         data-initiative-state-dropdown-related-count-value="<%= related_project_count %>">
      <button class="state-pill-toggle" type="button" data-action="initiative-state-dropdown#toggle">
        <span class="state-pill state-pill--<%= initiative_record.current_state.to_s.tr('_', '-') %>" data-initiative-state-dropdown-target="badge"><%= initiative_record.current_state.to_s.tr('_', ' ').titleize %></span>
        <span class="state-pill-arrow">▾</span>
      </button>
      <div class="state-pill-menu state-pill-menu--down" data-initiative-state-dropdown-target="menu">
        <% if allowed_states.any? %>
          <% allowed_states.each do |state| %>
            <button type="button"
                    class="state-pill-option"
                    data-state="<%= state %>"
                    data-cascades="<%= cascading_states.include?(state) %>"
                    data-action="initiative-state-dropdown#select">
              <span class="state-pill state-pill--<%= state.to_s.tr('_', '-') %>"><%= state.to_s.tr('_', ' ').titleize %></span>
            </button>
          <% end %>
        <% else %>
          <div class="empty">No further transitions</div>
        <% end %>
      </div>
    </div>
    <button type="button" class="project-hero__edit-btn" data-action="edit-form#open" aria-label="Edit initiative">✎</button>
  </div>
  <h1 class="project-hero__title" data-project-title><%= initiative_record.name %></h1>
  <p class="project-hero__tagline" data-project-tagline<%= ' hidden' if initiative_record.description.blank? %>><%= initiative_record.description %></p>
  <% if initiative_record.point_of_contact.present? %>
    <p class="project-hero__contact" data-project-contact>For more information, contact <strong data-project-poc><%= initiative_record.point_of_contact %></strong>.</p>
  <% else %>
    <p class="project-hero__contact project-hero__contact--missing" data-project-contact>Psst! Do me a favor! Tell me who to call if this thing breaks!</p>
  <% end %>
</div>
